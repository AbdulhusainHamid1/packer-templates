---
description: Travis CI meta docker import template
variables:
  docker_import_image: "{{ env `DOCKER_IMPORT_IMAGE` }}"
  docker_import_name: "{{ env `DOCKER_IMPORT_NAME` }}"
builders:
- type: vmware-vmx
  name: ci-docker-import-{{ user `docker_import_name` }}
  vm_name: ci-docker-import-{{ user `docker_import_name` }}
  source_path: output-ci-docker-import-base/ci-docker-import-base.vmx
  ssh_username: travis
  ssh_password: travis
  ssh_port: 22
  ssh_wait_timeout: 10000s
  headless: true
provisioners:
- type: file
  source: packer-assets/docker-import-excludes
  destination: "/var/tmp/excludes"
- type: shell
  scripts:
  - packer-scripts/import-docker-image
  - packer-scripts/cleanup
  - packer-scripts/minimize
  environment_vars:
  - TARFILE=/var/tmp/{{ user `docker_import_name` }}.tar
  - IMAGE={{ user `docker_import_image` }}
  execute_command: "{{ .Vars }} exec sudo -E -S bash '{{ .Path }}'"
post-processors:
- type: vagrant
  keep_input_artifact: true
